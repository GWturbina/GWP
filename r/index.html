<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- OG Tags (дефолтные — для не-Vercel хостинга) -->
  <!-- На Vercel OG-теги генерирует api/r.js через vercel.json rewrite -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="GlobalWay Ecosystem">
  <meta property="og:title" content="GlobalWay — Присоединяйтесь!">
  <meta property="og:description" content="Децентрализованная экосистема на opBNB blockchain">
  <meta property="og:image" content="https://gwp-navy.vercel.app/assets/og/gw-default.png">
  
  <title>GlobalWay — Перенаправление</title>
  <link rel="icon" href="../assets/icons/favicon.ico">
  
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{min-height:100vh;background:#000d1a;color:#fff;font-family:Inter,sans-serif;display:flex;align-items:center;justify-content:center}
    .box{text-align:center;padding:40px}
    .spinner{width:36px;height:36px;border:3px solid rgba(255,215,0,0.15);border-top-color:#ffd700;border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 16px}
    @keyframes spin{to{transform:rotate(360deg)}}
    p{color:rgba(255,255,255,0.5);font-size:14px}
  </style>
</head>
<body>
  <div class="box">
    <div class="spinner"></div>
    <p>Перенаправление...</p>
  </div>
  
  <script>
    (function() {
      // Формат короткого кода v3: {dirChar}{base36userId}
      // g = GlobalWay, c = CardGift, n = NSS
      // Пример: g1 → direction=gw, userId=1
      //         c2s → direction=cg, userId=100
      
      const params = new URLSearchParams(window.location.search);
      const code = params.get('code') || window.location.pathname.split('/').pop();
      
      if (!code || code.length < 2) {
        window.location.href = '/';
        return;
      }

      const dirMap = { 'g': 'gw', 'c': 'cg', 'n': 'nss' };
      const dirChar = code[0].toLowerCase();
      const direction = dirMap[dirChar];

      if (!direction) {
        window.location.href = '/';
        return;
      }

      // Декодируем userId из base36
      const userIdBase36 = code.substring(1);
      const userId = parseInt(userIdBase36, 36);
      
      if (isNaN(userId) || userId < 1) {
        window.location.href = '/';
        return;
      }

      // Получаем доп. параметры
      const name = params.get('n') || '';
      
      // Перенаправляем на landing page
      let targetUrl = `/ref/${direction}.html?id=${userId}`;
      if (name) targetUrl += '&name=' + encodeURIComponent(name);
      
      window.location.replace(targetUrl);
    })();
  </script>
</body>
</html>
